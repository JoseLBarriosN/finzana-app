<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finzana - Sistema de Gesti√≥n de Cr√©ditos</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2E8B57">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Finzana">
    <link rel="apple-touch-icon" href="assets/logo.png">

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        .required {
            color: var(--danger);
            font-weight: bold;
        }

        .field-note {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }

        .search-group {
            display: flex;
            gap: 10px;
        }

            .search-group input {
                flex: 1;
            }
            
        .status-al-corriente {
            color: var(--success);
            font-weight: bold;
        }

        .status-atrasado {
            color: var(--warning);
            font-weight: bold;
        }

        .status-cobranza {
            color: var(--danger);
            font-weight: bold;
        }

        .status-juridico {
            color: #B71C1C;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Conectando con el servidor...</p>
    </div>

    <div id="login-screen" class="login-container hidden">
        <div class="login-box">
            <div class="login-logo"> <img src="assets/logo.png" alt="Logo de Finzana" style="width: 60px; height: auto;"></div>
            <h1>Bienvenido a Finzana</h1>
            <p>Sistema de gesti√≥n de cr√©ditos</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Correo Electr√≥nico</label>
                    <input type="email" id="email" placeholder="Ingresa tu correo" required value="barrios.nunez.joseluis@gmail.com">
                </div>
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" placeholder="Ingresa tu contrase√±a" required>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n</button>
            </form>
            <p id="auth-status" class="auth-status"></p>
        </div>
    </div>

    <div id="main-app" class="app-container hidden">
        <header class="app-header">
            <div class="user-info">
                <div class="user-avatar"><i class="fas fa-user"></i></div>
                <div>
                    <div id="user-name">Usuario Finzana</div>
                    <div id="user-role-display">Sistema de Cr√©ditos</div>
                </div>
            </div>
            <button id="logout-btn" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</button>
        </header>

        <main class="app-content">
            <div id="view-main-menu" class="view">
                <h2>Panel de Control</h2>
                <div class="menu-grid">
                    <div class="menu-card" data-view="view-gestion-clientes">
                        <div class="menu-icon icon-clientes"><i class="fas fa-users"></i></div>
                        <h3>Gesti√≥n de Clientes</h3>
                        <p>Consulta y administra clientes</p>
                        <button class="btn btn-primary" data-view="view-gestion-clientes"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-usuarios">
                        <div class="menu-icon icon-usuarios"><i class="fas fa-user-cog"></i></div>
                        <h3>Gesti√≥n de Usuarios</h3>
                        <p>Administra usuarios del sistema</p>
                        <button class="btn btn-primary" data-view="view-usuarios"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-importar">
                        <div class="menu-icon icon-importar"><i class="fas fa-file-import"></i></div>
                        <h3>Importar Datos</h3>
                        <p>Carga informaci√≥n desde CSV</p>
                        <button class="btn btn-primary" data-view="view-importar"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-cliente">
                        <div class="menu-icon icon-registrar"><i class="fas fa-user-plus"></i></div>
                        <h3>Registrar Cliente</h3>
                        <p>Agrega nuevos clientes</p>
                        <button class="btn btn-primary" data-view="view-cliente"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-colocacion">
                        <div class="menu-icon icon-colocacion"><i class="fas fa-hand-holding-usd"></i></div>
                        <h3>Generar Cr√©dito</h3>
                        <p>Crea nuevos cr√©ditos</p>
                        <button class="btn btn-primary" data-view="view-colocacion"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-cobranza">
                        <div class="menu-icon icon-cobranza"><i class="fas fa-cash-register"></i></div>
                        <h3>Registrar Pago</h3>
                        <p>Registra pagos de cr√©ditos</p>
                        <button class="btn btn-primary" data-view="view-cobranza"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-reportes">
                        <div class="menu-icon icon-reportes"><i class="fas fa-chart-bar"></i></div>
                        <h3>Reportes B√°sicos</h3>
                        <p>Consulta estad√≠sticas generales</p>
                        <button class="btn btn-primary" data-view="view-reportes"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-reportes-avanzados">
                        <div class="menu-icon icon-reportes-avanzados"><i class="fas fa-chart-line"></i></div>
                        <h3>Reportes Avanzados</h3>
                        <p>Reportes detallados con filtros</p>
                        <button class="btn btn-primary" data-view="view-reportes-avanzados"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                </div>
            </div>

            <div id="view-gestion-clientes" class="view hidden">
                <div class="view-header">
                    <h2>Gesti√≥n de Clientes</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <div class="filtros-container">
                    <h3>Filtros de B√∫squeda</h3>
                    <div id="filtros-grid" class="filtros-grid">
                        <div class="form-group">
                            <label for="sucursal_filtro">Sucursal</label>
                            <select id="sucursal_filtro">
                                <option value="">Todas</option>
                                <option value="GDL">Guadalajara</option>
                                <option value="LEON">Le√≥n</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="curp_filtro">CURP Cliente</label>
                            <input type="text" id="curp_filtro" placeholder="Buscar por CURP...">
                        </div>
                        <div class="form-group">
                            <label for="nombre_filtro">Nombre Cliente</label>
                            <input type="text" id="nombre_filtro" placeholder="Buscar por nombre...">
                        </div>
                        <div class="form-group">
                            <label for="fecha_registro_filtro">Fecha de Registro</label>
                            <input type="date" id="fecha_registro_filtro">
                        </div>
                        <div class="form-group">
                            <label for="fecha_credito_filtro">Fecha de Cr√©dito</label>
                            <input type="date" id="fecha_credito_filtro">
                        </div>
                        <div class="form-group">
                            <label for="tipo_colocacion_filtro">Tipo de Colocaci√≥n</label>
                            <select id="tipo_colocacion_filtro"></select>
                        </div>
                        <div class="form-group">
                            <label for="plazo_filtro">Plazo</label>
                            <select id="plazo_filtro"></select>
                        </div>
                        <div class="form-group">
                            <label for="curp_aval_filtro">CURP Aval</label>
                            <input type="text" id="curp_aval_filtro" placeholder="Buscar por CURP de aval...">
                        </div>
                        <div class="form-group">
                            <label for="grupo_filtro">Grupo o Poblaci√≥n</label>
                            <select id="grupo_filtro"></select>
                        </div>
                    </div>
                    <div class="filtros-actions">
                        <button id="btn-aplicar-filtros" class="btn btn-primary"><i class="fas fa-search"></i> Filtrar</button>
                        <button id="btn-limpiar-filtros" class="btn btn-secondary"><i class="fas fa-times"></i> Limpiar</button>
                    </div>
                </div>
                <div id="status_gestion_clientes"></div>
                <table class="client-table">
                    <thead>
                        <tr>
                            <th>Sucursal</th>
                            <th>CURP</th>
                            <th>Nombre</th>
                            <th>Grupo</th>
                            <th>Informaci√≥n de Cr√©dito</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-clientes">
                        <tr>
                            <td colspan="6">Utiliza los filtros para buscar y mostrar clientes.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="view-usuarios" class="view hidden">
                <div class="view-header">
                    <h2>Gesti√≥n de Usuarios</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>

                <div class="filtros-usuarios">
                    <h3>Filtros de B√∫squeda</h3>
                    <div class="filtros-usuarios-grid">
                        <div class="form-group">
                            <label for="filtro-email-usuario">Email</label>
                            <input type="text" id="filtro-email-usuario" placeholder="Buscar por email...">
                        </div>
                        <div class="form-group">
                            <label for="filtro-nombre-usuario">Nombre</label>
                            <input type="text" id="filtro-nombre-usuario" placeholder="Buscar por nombre...">
                        </div>
                        <div class="form-group">
                            <label for="filtro-rol-usuario">Rol</label>
                            <select id="filtro-rol-usuario">
                                <option value="">Todos los roles</option>
                                <option value="admin">Administrador</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="cobrador">Cobrador</option>
                                <option value="consulta">Consulta</option>
                            </select>
                        </div>
                    </div>
                    <div class="filtros-usuarios-actions">
                        <button id="btn-aplicar-filtros-usuarios" class="btn btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <button id="btn-limpiar-filtros-usuarios" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Limpiar Filtros
                        </button>
                    </div>
                </div>

                <button id="btn-nuevo-usuario" class="btn btn-primary"><i class="fas fa-user-plus"></i> Nuevo Usuario</button>
                <div id="status_usuarios"></div>
                <div id="form-usuario-container" class="hidden">
                    <h3 id="form-usuario-titulo">Nuevo Usuario</h3>
                    <form id="form-usuario">
                        <div class="form-group">
                            <label for="nuevo-email">Email <span class="required">*</span></label>
                            <input type="email" id="nuevo-email" required>
                        </div>
                        <div class="form-group">
                            <label for="nuevo-password">Contrase√±a <span class="required">*</span></label>
                            <input type="password" id="nuevo-password" required>
                        </div>
                        <div class="form-group">
                            <label for="nuevo-nombre">Nombre Completo <span class="required">*</span></label>
                            <input type="text" id="nuevo-nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="nuevo-rol">Rol <span class="required">*</span></label>
                            <select id="nuevo-rol" required>
                                <option value="admin">Administrador</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="cobrador">Cobrador</option>
                                <option value="consulta">Consulta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar</button>
                            <button type="button" id="btn-cancelar-usuario" class="btn btn-secondary"><i class="fas fa-times"></i> Cancelar</button>
                        </div>
                    </form>
                </div>
                <table class="user-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Nombre</th>
                            <th>Rol</th>
                            <th>Sucursal</th>
                            <th>UID</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-usuarios">
                        <tr>
                            <td colspan="5">No hay usuarios en la base de datos de perfiles.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="view-importar" class="view hidden">
                <div class="view-header">
                    <h2>Importar Datos</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <div class="form-group">
                    <label for="office-select">Selecciona la Sucursal para Importar</label>
                    <select id="office-select">
                        <option value="GDL">Guadalajara</option>
                        <option value="LEON">Le√≥n</option>
                    </select>
                </div>

                <div id="import-gdl-section">
                    <div class="import-tabs">
                        <div class="import-tab active" data-tab="clientes">Clientes</div>
                        <div class="import-tab" data-tab="colocacion">Colocaci√≥n</div>
                        <div class="import-tab" data-tab="cobranza">Cobranza</div>
                    </div>
                    <div id="tab-gdl-clientes" class="import-tab-content">
                        <div class="import-section">
                            <h4>Formato Guadalajara - Clientes (7 columnas)</h4>
                            <p>CURP, NOMBRE, DOMICILIO, CP, TELEFONO, FECHA REGISTRO, GRUPO</p>
                        </div>
                        <textarea id="datos-importar-gdl-clientes" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                    <div id="tab-gdl-colocacion" class="import-tab-content hidden">
                        <div class="import-section">
                            <h4>Formato Guadalajara - Colocaci√≥n (13 columnas)</h4>
                            <p>CURP, NOMBRE, ID, FECHA, TIPO, MONTO, PLAZO, MONTO A PAGAR, CURP AVAL, NOMBRE AVAL, GRUPO, RUTA, SALDO</p>
                        </div>
                        <textarea id="datos-importar-gdl-colocacion" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                    <div id="tab-gdl-cobranza" class="import-tab-content hidden">
                        <div class="import-section">
                            <h4>Formato Guadalajara - Cobranza (11 columnas)</h4>
                            <p>NOMBRE, ID CREDITO, FECHA, MONTO PAGO, COBRO SEMANA, COMISION, TIPO PAGO, GRUPO, RUTA, SEMANA CREDITO, SALDO</p>
                        </div>
                        <textarea id="datos-importar-gdl-cobranza" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                </div>

                <div id="import-leon-section" class="hidden">
                    <div class="import-tabs">
                        <div class="import-tab active" data-tab="clientes">Clientas</div>
                        <div class="import-tab" data-tab="colocacion">Colocaci√≥n</div>
                        <div class="import-tab" data-tab="cobranza">Cobranza</div>
                    </div>
                    <div id="tab-leon-clientes" class="import-tab-content">
                        <div class="import-section">
                            <h4>Formato Le√≥n - Clientas (7 columnas)</h4>
                            <p>CURP, NOMBRE, DOMICILIO, CP, TELEFONO, FECHA REGISTRO, GRUPO</p>
                        </div>
                        <textarea id="datos-importar-leon-clientes" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                    <div id="tab-leon-colocacion" class="import-tab-content hidden">
                        <div class="import-section">
                            <h4>Formato Le√≥n - Colocaci√≥n (20 columnas)</h4>
                            <p>CURP, NOMBRE, ID, FECHA, TIPO, MONTO, PLAZO, MONTO A PAGAR, CURP AVAL, NOMBRE AVAL, GRUPO, RUTA, INTERES, SALDO, ULTIMO PAGO, SALDO VENCIDO, STATUS, SALDO CAPITAL, SALDO INTERES, STJ150</p>
                        </div>
                        <textarea id="datos-importar-leon-colocacion" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                    <div id="tab-leon-cobranza" class="import-tab-content hidden">
                        <div class="import-section">
                            <h4>Formato Le√≥n - Cobranza (11 columnas)</h4>
                            <p>NOMBRE, ID CREDITO, FECHA, MONTO PAGO, COMISION, TIPO PAGO, GRUPO, RUTA, INTERES COBRADO, SALDO, COBRADO POR</p>
                        </div>
                        <textarea id="datos-importar-leon-cobranza" rows="8" placeholder="Pega aqu√≠ los datos CSV..."></textarea>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <button id="btn-procesar-importacion" class="btn btn-primary"><i class="fas fa-file-import"></i> Procesar</button>
                    <button id="btn-limpiar-datos" class="btn btn-danger"><i class="fas fa-trash"></i> Limpiar BD</button>
                </div>
                <div id="resultado-importacion" class="hidden">
                    <div id="estado-importacion"></div>
                    <div id="detalle-importacion"></div>
                </div>
            </div>

            <div id="view-cliente" class="view hidden">
                <div class="view-header">
                    <h2>Registrar Cliente</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <form id="form-cliente">
                    <div class="form-group">
                        <label for="office_cliente">Oficina <span class="required">*</span></label>
                        <select id="office_cliente" required>
                            <option value="GDL" selected>Guadalajara</option>
                            <option value="LEON">Le√≥n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="curp_cliente">CURP <span class="required">*</span></label>
                        <input type="text" id="curp_cliente" placeholder="18 caracteres" required maxlength="18">
                        <div class="field-note">18 caracteres</div>
                    </div>
                    <div class="form-group">
                        <label for="nombre_cliente">Nombre Completo <span class="required">*</span></label>
                        <input type="text" id="nombre_cliente" required>
                    </div>
                    <div class="form-group">
                        <label for="domicilio_cliente">Domicilio <span class="required">*</span></label>
                        <input type="text" id="domicilio_cliente" required>
                    </div>
                    <div class="form-group">
                        <label for="cp_cliente">C√≥digo Postal</label>
                        <input type="text" id="cp_cliente">
                    </div>
                    <div class="form-group">
                        <label for="telefono_cliente">Tel√©fono</label>
                        <input type="text" id="telefono_cliente">
                    </div>
                    <div class="form-group">
                        <label for="poblacion_grupo_cliente">Poblaci√≥n/Grupo <span class="required">*</span></label>
                        <select id="poblacion_grupo_cliente" required></select>
                    </div>
                    <div class="form-group">
                        <label for="ruta_cliente">Ruta <span class="required">*</span></label>
                        <select id="ruta_cliente" required></select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar Cliente</button>
                        <button type="button" class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-times"></i> Cancelar</button>
                    </div>
                </form>
                <div id="status_cliente"></div>
            </div>

            <div id="view-colocacion" class="view hidden">
                <div class="view-header">
                    <h2>Generar Cr√©dito</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <div class="form-group">
                    <label for="curp_colocacion">CURP del Cliente <span class="required">*</span></label>
                    <div class="search-group">
                        <input type="text" id="curp_colocacion" required>
                        <button id="btnBuscarCliente_colocacion" class="btn btn-primary"><i class="fas fa-search"></i> Buscar</button>
                    </div>
                </div>
                <div id="form-colocacion" class="hidden">
                    <form id="form-credito-submit">
                        <div class="form-group">
                            <label>Nombre del Cliente</label>
                            <input type="text" id="nombre_colocacion" readonly>
                        </div>
                        <div class="form-group">
                            <label>ID del Cr√©dito</label>
                            <input type="text" id="idCredito_colocacion" readonly>
                        </div>
                        <div class="form-group">
                            <label for="tipo_colocacion">Tipo <span class="required">*</span></label>
                            <select id="tipo_colocacion" required></select>
                        </div>
                        <div class="form-group">
                            <label for="monto_colocacion">Monto <span class="required">*</span></label>
                            <select id="monto_colocacion" required></select>
                        </div>
                        <div class="form-group">
                            <label for="plazo_colocacion">Plazo (semanas) <span class="required">*</span></label>
                            <select id="plazo_colocacion" required></select>
                        </div>
                        <div class="form-group">
                            <label>Monto Total a Pagar</label>
                            <input type="text" id="montoTotal_colocacion" readonly>
                            <div class="field-note">Incluye 30% de inter√©s</div>
                        </div>
                        <div class="form-group">
                            <label for="curpAval_colocacion">CURP Aval <span class="required">*</span></label>
                            <input type="text" id="curpAval_colocacion" placeholder="18 caracteres" required maxlength="18">
                            <div class="field-note">18 caracteres</div>
                        </div>
                        <div class="form-group">
                            <label for="nombreAval_colocacion">Nombre Aval <span class="required">*</span></label>
                            <input type="text" id="nombreAval_colocacion" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-success"><i class="fas fa-hand-holding-usd"></i> Generar Cr√©dito</button>
                            <button type="button" class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-times"></i> Cancelar</button>
                        </div>
                    </form>
                </div>
                <div id="status_colocacion"></div>
            </div>

            <div id="view-cobranza" class="view hidden">
                <div class="view-header">
                    <h2>Registrar Pago</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <div class="form-group">
                    <label for="idCredito_cobranza">ID del Cr√©dito <span class="required">*</span></label>
                    <div class="search-group">
                        <input type="text" id="idCredito_cobranza" required>
                        <button id="btnBuscarCredito_cobranza" class="btn btn-primary"><i class="fas fa-search"></i> Buscar</button>
                    </div>
                </div>
                <div id="form-cobranza" class="hidden">
                    <form id="form-pago-submit">
                        <div class="form-group">
                            <label>Nombre Cliente</label>
                            <input type="text" id="nombre_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label>Saldo Actual</label>
                            <input type="text" id="saldo_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label>Estado del Cr√©dito</label>
                            <input type="text" id="estado_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label>Semanas de Atraso</label>
                            <input type="text" id="semanas_atraso_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label for="pago_semanal_cobranza">Monto de Pago Semanal</label>
                            <input type="text" id="pago_semanal_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label for="fecha_proximo_pago_cobranza">Fecha Pr√≥ximo Pago</label>
                            <input type="text" id="fecha_proximo_pago_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <label for="monto_cobranza">Monto del Pago <span class="required">*</span></label>
                            <input type="number" id="monto_cobranza" min="0.01" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="tipo_cobranza">Tipo de Pago <span class="required">*</span></label>
                            <select id="tipo_cobranza" required>
                                <option value="normal">Normal</option>
                                <option value="extraordinario">Extraordinario</option>
                                <option value="actualizado">Actualizado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Saldo Despu√©s del Pago</label>
                            <input type="text" id="saldoDespues_cobranza" readonly>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-success"><i class="fas fa-cash-register"></i> Registrar Pago</button>
                            <button type="button" class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-times"></i> Cancelar</button>
                        </div>
                    </form>
                </div>
                <div id="status_cobranza"></div>
            </div>

            <div id="view-reportes" class="view hidden">
                <div class="view-header">
                    <h2>Reportes del Sistema</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>
                <button id="btn-actualizar-reportes" class="btn btn-primary"><i class="fas fa-sync-alt"></i> Actualizar Reportes</button>
                <div class="report-grid">
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-users"></i></div>
                        <div class="report-value" id="total-clientes">0</div>
                        <div class="report-label">Total Clientes</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                        <div class="report-value" id="total-creditos">0</div>
                        <div class="report-label">Cr√©ditos Activos</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-money-bill-wave"></i></div>
                        <div class="report-value" id="total-cartera">$0</div>
                        <div class="report-label">Total Cartera</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="report-value" id="total-vencidos">0</div>
                        <div class="report-label">Cr√©ditos Vencidos</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-receipt"></i></div>
                        <div class="report-value" id="pagos-registrados">0</div>
                        <div class="report-label">Pagos del Mes</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-coins"></i></div>
                        <div class="report-value" id="cobrado-mes">$0</div>
                        <div class="report-label">Cobrado Este Mes</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-percentage"></i></div>
                        <div class="report-value" id="tasa-recuperacion">0%</div>
                        <div class="report-label">Tasa de Recuperaci√≥n</div>
                    </div>
                    <div class="report-card">
                        <div class="report-icon"><i class="fas fa-hand-holding-usd"></i></div>
                        <div class="report-value" id="total-comisiones">$0</div>
                        <div class="report-label">Comisiones del Mes</div>
                    </div>
                </div>
                <div id="status_reportes"></div>
            </div>

            <div id="view-reportes-avanzados" class="view hidden">
                <div class="view-header">
                    <h2>Reportes Avanzados</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Men√∫</button>
                </div>

                <div class="advanced-filters">
                    <h3>Filtros de Reporte</h3>
                    <div id="filtros-reportes-avanzados" class="filtros-grid">
                        <div class="form-group">
                            <label for="sucursal_filtro_reporte">Sucursal</label>
                            <select id="sucursal_filtro_reporte">
                                <option value="">Todas</option>
                                <option value="GDL">Guadalajara</option>
                                <option value="LEON">Le√≥n</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grupo_filtro_reporte">Grupo/Poblaci√≥n</label>
                            <select id="grupo_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ruta_filtro_reporte">Ruta</label>
                            <select id="ruta_filtro_reporte">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipo_credito_filtro_reporte">Tipo de Cr√©dito</label>
                            <select id="tipo_credito_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="estado_credito_filtro_reporte">Estado de Cr√©dito</label>
                            <select id="estado_credito_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipo_pago_filtro_reporte">Tipo de Pago</label>
                            <select id="tipo_pago_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="curp_filtro_reporte">CURP Cliente</label>
                            <input type="text" id="curp_filtro_reporte" placeholder="Filtrar por CURP...">
                        </div>
                        <div class="form-group">
                            <label for="id_credito_filtro_reporte">ID Cr√©dito</label>
                            <input type="text" id="id_credito_filtro_reporte" placeholder="Filtrar por ID cr√©dito...">
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-section-title">Rango de Fechas</div>
                        <div class="date-range">
                            <div class="form-group">
                                <label for="fecha_inicio_reporte">Fecha Inicio</label>
                                <input type="date" id="fecha_inicio_reporte">
                            </div>
                            <div class="form-group">
                                <label for="fecha_fin_reporte">Fecha Fin</label>
                                <input type="date" id="fecha_fin_reporte">
                            </div>
                        </div>
                    </div>

                    <div class="filtros-actions">
                        <button id="btn-aplicar-filtros-reportes" class="btn btn-primary">
                            <i class="fas fa-search"></i> Generar Reporte
                        </button>
                        <button id="btn-limpiar-filtros-reportes" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Limpiar Filtros
                        </button>
                    </div>
                </div>

                <div id="estadisticas-reporte"></div>

                <div class="export-buttons">
                    <button id="btn-exportar-csv" class="btn btn-success">
                        <i class="fas fa-file-csv"></i> Exportar CSV
                    </button>
                    <button id="btn-exportar-pdf" class="btn btn-danger">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                </div>

                <div id="status_reportes_avanzados"></div>

                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>CURP</th>
                            <th>Nombre</th>
                            <th>Grupo/Poblaci√≥n</th>
                            <th>Ruta</th>
                            <th>Sucursal</th>
                            <th>Fecha</th>
                            <th>Tipo Operaci√≥n</th>
                            <th>Monto</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-reportes-avanzados">
                        <tr>
                            <td colspan="10">Aplica los filtros para generar el reporte.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <!-- Configuraci√≥n Firebase -->
    <script src="js/firebase-config.js"></script>

    <!-- Nuestra l√≥gica de aplicaci√≥n -->
    <script src="js/database.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker y PWA -->
    <script>
    // Registrar Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('‚úÖ ServiceWorker registrado correctamente: ', registration.scope);
            
            // Verificar si hay una nueva versi√≥n del Service Worker
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('üîÑ Nueva versi√≥n del Service Worker encontrada');
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('üîÑ Nueva versi√≥n disponible. Recarga la p√°gina para actualizar.');
                  if (typeof showStatus === 'function') {
                    showStatus('status_general', 'Nueva versi√≥n disponible. Recarga la p√°gina para actualizar.', 'info');
                  }
                }
              });
            });
          })
          .catch(function(error) {
            console.log('‚ùå Error registrando ServiceWorker: ', error);
          });
      });

      // Detectar cambios de conexi√≥n
      window.addEventListener('online', function() {
        console.log('üåê Conexi√≥n recuperada - Sincronizando datos...');
        if (typeof database !== 'undefined' && database.sincronizarDatosPendientes) {
          database.sincronizarDatosPendientes();
        }
        
        // Mostrar notificaci√≥n
        if (typeof showStatus === 'function') {
          showStatus('status_general', 'Conexi√≥n recuperada. Sincronizando datos...', 'success');
        }
      });

      window.addEventListener('offline', function() {
        console.log('üì¥ Sin conexi√≥n - Modo offline activado');
        if (typeof showStatus === 'function') {
          showStatus('status_general', 'Modo offline activado. Puedes seguir trabajando.', 'warning');
        }
      });
    }

    // Detectar si la app est√° instalada
    window.addEventListener('appinstalled', (evt) => {
      console.log('üì± Aplicaci√≥n instalada correctamente');
    });

    // Funci√≥n para instalar la PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      console.log('üì≤ PWA lista para instalar');
      
      // Mostrar bot√≥n de instalaci√≥n
      const installButton = document.createElement('button');
      installButton.textContent = 'üì± Instalar App';
      installButton.className = 'btn btn-primary';
      installButton.style.margin = '10px';
      installButton.onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('‚úÖ Usuario acept√≥ instalar la PWA');
            installButton.style.display = 'none';
          }
          deferredPrompt = null;
        });
      };
      
      // Agregar bot√≥n al header si existe
      const appHeader = document.querySelector('.app-header');
      if (appHeader) {
        appHeader.appendChild(installButton);
      }
    });

    // Verificar si la app se est√° ejecutando en modo standalone (PWA)
    if (window.matchMedia('(display-mode: standalone)').matches) {
      console.log('üì± Ejecutando en modo PWA');
    }
    </script>
</body>
</html>
