<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finzana - Sistema de Gestión de Créditos</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        .required {
            color: var(--danger);
            font-weight: bold;
        }

        .field-note {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }

        .search-group {
            display: flex;
            gap: 10px;
        }

        .search-group input {
            flex: 1;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Conectando con el servidor...</p>
    </div>

    <div id="login-screen" class="login-container hidden">
        <div class="login-box">
            <div class="login-logo"><i class="fas fa-hand-holding-usd"></i></div>
            <h1>Bienvenido a Finzana</h1>
            <p>Sistema de gestión de créditos</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" placeholder="Ingresa tu correo" required value="barrios.nunez.joseluis@gmail.com">
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" placeholder="Ingresa tu contraseña" required>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</button>
            </form>
            <p id="auth-status" class="auth-status"></p>
        </div>
    </div>

    <div id="main-app" class="app-container hidden">
        <header class="app-header">
            <div class="user-info">
                <div class="user-avatar"><i class="fas fa-user"></i></div>
                <div>
                    <div id="user-name">Usuario Finzana</div>
                    <div id="user-role-display">Sistema de Créditos</div>
                </div>
            </div>
            <button id="logout-btn" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
        </header>

        <main class="app-content">
            <div id="view-main-menu" class="view">
                <h2>Panel de Control</h2>
                <div class="menu-grid">
                    <div class="menu-card" data-view="view-gestion-clientes">
                        <div class="menu-icon icon-clientes"><i class="fas fa-users"></i></div>
                        <h3>Gestión de Clientes</h3>
                        <p>Consulta y administra clientes</p>
                        <button class="btn btn-primary" data-view="view-gestion-clientes"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-usuarios">
                        <div class="menu-icon icon-usuarios"><i class="fas fa-user-cog"></i></div>
                        <h3>Gestión de Usuarios</h3>
                        <p>Administra usuarios del sistema</p>
                        <button class="btn btn-primary" data-view="view-usuarios"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-importar">
                        <div class="menu-icon icon-importar"><i class="fas fa-file-import"></i></div>
                        <h3>Importar Datos</h3>
                        <p>Carga información desde CSV</p>
                        <button class="btn btn-primary" data-view="view-importar"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-cliente">
                        <div class="menu-icon icon-registrar"><i class="fas fa-user-plus"></i></div>
                        <h3>Registrar Cliente</h3>
                        <p>Agrega nuevos clientes</p>
                        <button class="btn btn-primary" data-view="view-cliente"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-colocacion">
                        <div class="menu-icon icon-colocacion"><i class="fas fa-hand-holding-usd"></i></div>
                        <h3>Generar Crédito</h3>
                        <p>Crea nuevos créditos</p>
                        <button class="btn btn-primary" data-view="view-colocacion"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-cobranza">
                        <div class="menu-icon icon-cobranza"><i class="fas fa-cash-register"></i></div>
                        <h3>Registrar Pago</h3>
                        <p>Registra pagos de créditos</p>
                        <button class="btn btn-primary" data-view="view-cobranza"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-reportes">
                        <div class="menu-icon icon-reportes"><i class="fas fa-chart-bar"></i></div>
                        <h3>Reportes Básicos</h3>
                        <p>Consulta estadísticas generales</p>
                        <button class="btn btn-primary" data-view="view-reportes"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                    <div class="menu-card" data-view="view-reportes-avanzados">
                        <div class="menu-icon icon-reportes-avanzados"><i class="fas fa-chart-line"></i></div>
                        <h3>Reportes Avanzados</h3>
                        <p>Reportes detallados con filtros</p>
                        <button class="btn btn-primary" data-view="view-reportes-avanzados"><i class="fas fa-arrow-right"></i> Acceder</button>
                    </div>
                </div>
            </div>

            <!-- Las demás vistas se mantienen igual que en tu código original -->
            <!-- Solo agrego la nueva vista de Reportes Avanzados -->

            <div id="view-reportes-avanzados" class="view hidden">
                <div class="view-header">
                    <h2>Reportes Avanzados</h2>
                    <button class="btn btn-secondary" data-view="view-main-menu"><i class="fas fa-arrow-left"></i> Volver al Menú</button>
                </div>

                <div class="advanced-filters">
                    <h3>Filtros de Reporte</h3>
                    <div id="filtros-reportes-avanzados" class="filtros-grid">
                        <div class="form-group">
                            <label for="sucursal_filtro_reporte">Sucursal</label>
                            <select id="sucursal_filtro_reporte">
                                <option value="">Todas</option>
                                <option value="GDL">Guadalajara</option>
                                <option value="LEON">León</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grupo_filtro_reporte">Grupo/Población</label>
                            <select id="grupo_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ruta_filtro_reporte">Ruta</label>
                            <select id="ruta_filtro_reporte">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipo_credito_filtro_reporte">Tipo de Crédito</label>
                            <select id="tipo_credito_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="estado_credito_filtro_reporte">Estado de Crédito</label>
                            <select id="estado_credito_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipo_pago_filtro_reporte">Tipo de Pago</label>
                            <select id="tipo_pago_filtro_reporte">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="curp_filtro_reporte">CURP Cliente</label>
                            <input type="text" id="curp_filtro_reporte" placeholder="Filtrar por CURP...">
                        </div>
                        <div class="form-group">
                            <label for="id_credito_filtro_reporte">ID Crédito</label>
                            <input type="text" id="id_credito_filtro_reporte" placeholder="Filtrar por ID crédito...">
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="filter-section-title">Rango de Fechas</div>
                        <div class="date-range">
                            <div class="form-group">
                                <label for="fecha_inicio_reporte">Fecha Inicio</label>
                                <input type="date" id="fecha_inicio_reporte">
                            </div>
                            <div class="form-group">
                                <label for="fecha_fin_reporte">Fecha Fin</label>
                                <input type="date" id="fecha_fin_reporte">
                            </div>
                        </div>
                    </div>

                    <div class="filtros-actions">
                        <button id="btn-aplicar-filtros-reportes" class="btn btn-primary">
                            <i class="fas fa-search"></i> Generar Reporte
                        </button>
                        <button id="btn-limpiar-filtros-reportes" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Limpiar Filtros
                        </button>
                    </div>
                </div>

                <div id="estadisticas-reporte"></div>

                <div class="export-buttons">
                    <button id="btn-exportar-csv" class="btn btn-success">
                        <i class="fas fa-file-csv"></i> Exportar CSV
                    </button>
                    <button id="btn-exportar-pdf" class="btn btn-danger">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                </div>

                <div id="status_reportes_avanzados"></div>

                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>CURP</th>
                            <th>Nombre</th>
                            <th>Grupo/Población</th>
                            <th>Ruta</th>
                            <th>Sucursal</th>
                            <th>Fecha</th>
                            <th>Tipo Operación</th>
                            <th>Monto</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-reportes-avanzados">
                        <tr>
                            <td colspan="10">Aplica los filtros para generar el reporte.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- El resto de las vistas se mantienen igual -->
            <!-- [Incluir aquí todas las demás vistas de tu código original] -->

        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBNt_JKONVgOXS4fgJrj3qldb1JBdOgPoE",
            authDomain: "finzana-app.firebaseapp.com",
            projectId: "finzana-app",
            storageBucket: "finzana-app.firebasestorage.app",
            messagingSenderId: "779745085151",
            appId: "1:779745085151:web:2d470408b6267e3e16cb6a"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    <script src="js/database.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
